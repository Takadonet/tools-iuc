<tool id="vsearch" name="VSearch" version="@VERSION@.0">
    <description></description>
    <expand macro="requirements" />
    <expand macro="stdio" />
    <expand macro="version_command" />
    <macros>
        <import>vsearch_macros.xml</import>
    </macros>
    <command>
<![CDATA[
    vsearch

        @GENERAL@
        --db $dbfile
        --dbmask $dbmask
        --dbmatched $dbmatched
        --dbnotmatched $dbnotmatched

        --fastapairs $fastapairs
        #--fulldp                    full dynamic programming alignment (always on)
        #--gapext STRING             penalties for gap extension (2I/1E)
        #--gapopen STRING            penalties for gap opening (20I/2E)
        $hardmask
        --id $id
        --iddef $iddef

        $leftjust
        #if $matched:
            --matched $matched
        #end if
        --maxid $maxid
        --maxqt $maxqsize
        --maxsizeratio $maxsizeratio
        --maxsl $maxsl
        --mid $mid
        --minqt $minqt
        --minsizeratio $minseqlength
        --minsl $minsl

        --mintsize $mintsize
        --mismatch $mismatch
        --maxqsize $maxqsize
        --mincols $mincols
        --maxsubs $maxsubs
        --maxrejects $maxrejects
        --maxaccepts $maxaccepts
        --maxdiffs $maxdiffs
        --maxgaps $maxgaps
        --maxhits $maxhits
        --match $match
        --idprefix $idprefix
        --idsuffix $idsuffix

        --notmatched $notmatched
        $output_no_hits
        #if $qmask != 'no':
            --qmask $qmask
        #end if
        --query_cov $query_cov

        $rightjust
        ##--rowlen INT                width of alignment lines in alnout output (64)
        $self
        $selfid
        --sizeout $sizeout
        --strand $strand
        --target_cov $target_cov
        $top_hits_only

        --usearch_global $queryfile
        ##--userfields STRING         fields to output in userout file
        ##--userout FILENAME          filename for user-defined tab-separated output
        ##--weak_id REAL              include aligned hits with >= id; continue search
        --wordlength $wordlength

        #if '-uc' in $outputs:
            --uc $uc
            $uclust_output.uc_allhits
        #end if
        #if $alnout:
            --alnout $alnout
        #end if
        #if $blast6out:
            --blast6out $blast6out
        #end if

]]>
    </command>
    <inputs>
        <param name="queryfile" type="data" format="fasta" label="Select your query FASTA file" help="(--usearch_global)" />
        <param name="dbfile" type="data" format="fasta" label="Select your database FASTA file" help="(--db)" />

        <expand macro="qmask" />
        <expand macro="sizeout" />
        <expand macro="strand" />
        <expand macro="self_and_selfid" />
        <expand macro="id_and_iddef" />
        <expand macro="hardmask" />

        <param name="dbmask" type="select" label="Mask database sequences" help="(--dbmask)">
            <option value="no">No masking</option>
            <option value="dust" selected="True">dust</option>
            <option value="soft">soft</option>
        </param>

        <param name="top_hits_only" type="boolean" truevalue="--top_hits_only" falsevalue="" checked="False" 
            label="Output only hits with identity equal to the best" help="(--top_hits_only)"/>
        <param name="rightjust" type="boolean" truevalue="--rightjust" falsevalue="" checked="False" 
            label="Reject if terminal gaps at alignment right end" help="(--rightjust)"/>
        <param name="leftjust" type="boolean" truevalue="--leftjust" falsevalue="" checked="False" 
            label="Reject if terminal gaps at alignment left end" help="(--leftjust)"/>

        <param name="query_cov" type="float" value="" label="Reject if fraction of query seq. aligned lower than this value"
            help="(--query_cov)"/>
        <param name="target_cov" type="float" value="" label="Reject if fraction of target seq. aligned lower than this value"
            help="(--target_cov)"/>

        <param name="maxid" type="float" value="" label="Reject if identity higher than this value"
            help="(--maxid)"/>
        <param name="maxqt" type="float" value="" label="Reject if query/target length ratio higher than this value"
            help="(--maxqt)"/>
        <param name="maxsizeratio" type="float" value="" label="Reject if query/target abundance ratio higher than this value"
            help="(--maxsizeratio)"/>
        <param name="maxsl" type="float" value="" label="Reject if shorter/longer length ratio higher than this value"
            help="(--maxsl)"/>
        <param name="mid" type="float" value="" label="Reject if percent identity lower than this value, ignoring gaps"
            help="(--mid)"/>
        <param name="minqt" type="float" value="" label="Reject if query/target length ratio lower than this value"
            help="(--minqt)"/>
        <param name="minsl" type="float" value="" label="Reject if shorter/longer length ratio lower than this value"
            help="(--minsl)"/>
        <param name="minsizeratio" type="float" value="" label="Reject if query/target abundance ratio lower than this value"
            help="(--minsizeratio)"/>

        <param name="maxqsize" type="integer" value="" label="Reject if query abundance larger than this value"
            help="(--maxqsize)"/>
        <param name="mincols" type="integer" value="" label="Reject if alignment length shorter than this value"
            help="(--mincols)"/>
        <param name="maxsubs" type="integer" value="" label="Reject if more substitutions than this value"
            help="(--maxsubs)"/>
        <param name="maxrejects" type="integer" value="32" label="Number of non-matching hits to consider"
            help="(--maxrejects)"/>
        <param name="maxaccepts" type="integer" value="1" label="Number of hits to accept and show per strand"
            help="(--maxaccepts)"/>
        <param name="maxdiffs" type="integer" value="" label="Reject if more substitutions or indels than this value"
            help="(--maxdiffs)"/>
        <param name="maxgaps" type="integer" value="" label="Reject if more indels than this value"
            help="(--maxgaps)"/>
        <param name="maxhits" type="integer" value="" label="Maximum number of hits to show"
            help="(--maxhits)"/>
        <param name="match" type="integer" value="2" label="Score for match"
            help="(--match)"/>
        <param name="idprefix" type="integer" value="" label="Reject if first n nucleotides do not match"
            help="(--idprefix)"/>
        <param name="idsuffix" type="integer" value="" label="Reject if last n nucleotides do not match"
            help="(--idsuffix)"/>
        <param name="mintsize" type="integer" value="" label="Reject if target abundance lower"
            help="(--mintsize)"/>
        <param name="mismatch" type="integer" value="-4" label="Score for mismatch"
            help="(--mismatch)"/>

        <conditional name="uclust_output">
            <param name="uclust_output_select" type="select" label="UCLUST-like output" help="(--uc)">
                <option value="yes">Yes</option>
                <option value="no" selected="True">No</option>
            </param>
            <when value="yes">
                <param name="uc_allhits" type="boolean" truevalue="--uc_allhits" falsevalue="" checked="False" 
                    label="Show all, not just top hits" help="(--uc_allhits)"/>
            </when>
            <when value="no" />
        </conditional>

        <param name="wordlength" type="integer" value="8" min="3" max="15" label="Length of words for database index 3-15"
            help="Allowed values: 3-15 (--wordlength)"/>
        <param name="output_no_hits" type="boolean" truevalue="--output_no_hits" falsevalue="" checked="False" 
            label="Write non-matching queries to the output file" help="(--output_no_hits)"/>

        <param name="alnout" type="boolean" truevalue="" falsevalue="" checked="False" 
            label="Human-readable alignment output" help="(--alnout)"/>
        <param name="blast6out" type="boolean" truevalue="" falsevalue="" checked="False" 
            label="Blast-like tab-separated output" help="(--blast6out)"/>
        <param name="notmatched" type="boolean" truevalue="" falsevalue="" checked="False" 
            label="Write non-matching query sequences to separate file" help="(--notmatched)"/>
        <param name="matched" type="boolean" truevalue="" falsevalue="" checked="False" 
            label="Write matching query sequences to separate file" help="(--matched)"/>
        <param name="fastapairs" type="boolean" truevalue="" falsevalue="" checked="False" 
            label="Write query/target pairs of sequences" help="(--fastapairs)"/>

        <param name="outputs" type="select" label="Select output files" help="">
            <option value="--dbmatched">FASTA file for matching database sequences</option>
            <option value="--dbnotmatched">FASTA file for non-matching database sequences</option>
            <option value="--alnout">Human-readable alignment output</option>
            <option value="--blast6out" selected="True">Blast-like tab-separated output</option>
            <option value="--notmatched">Write non-matching query sequences to separate file</option>
            <option value="--matched">Write matching query sequences to separate file</option>
            <option value="--fastapairs">Write query/target pairs of sequences</option>
            <validator type="no_options" message="Please select at least one output."/>
        </param>

    </inputs>
    <outputs>
        <data name="uc" format="fasta" label="${tool.name} on ${on_string}: UCLUST like output">
            <filter>uclust_output.uclust_output_select == 'yes'</filter>
        </data>
        <data name="dbnotmatched" format="fasta" label="${tool.name} on ${on_string}: Non-matched database sequences">
            <filter>'--dbnotmatchedt' in outputs</filter>
        </data>
        <data name="dbmatched" format="fasta" label="${tool.name} on ${on_string}: Matched database sequences">
            <filter>'--dbmatched' in outputs</filter>
        </data>
        <data name="alnout" format="fasta" label="${tool.name} on ${on_string}: Alignment">
            <filter>'--alnout' in outputs</filter>
        </data>
        <data name="blast6out" format="tabular" label="${tool.name} on ${on_string}: BLAST like tabular">
            <filter>'--blast6out' in outputs</filter>
        </data>
        <data name="notmatched" format="fasta" label="${tool.name} on ${on_string}: Non-matched queries">
            <filter>'--notmatched' in outputs</filter>
        </data>
        <data name="matched" format="fasta" label="${tool.name} on ${on_string}: Matching query sequences">
            <filter>'--matched' in outputs</filter>
        </data>
        <data name="fastapairs" format="fasta" label="${tool.name} on ${on_string}: Query/Target sequences">
            <filter>'--fastapairs' in outputs</filter>
        </data>
    </outputs>
    <tests>
    </tests>
    <help>
<![CDATA[
**What it does**

General options
  --help                      display help information
  --version                   display version information
  --fasta_width INT           width of FASTA seq lines, 0 for no wrap (80)
  --maxseqlength INT          maximum sequence length (50000)
  --minseqlength INT          min seq length (clust/derep/search: 32, other:1)
  --notrunclabels             do not truncate labels at first space
  --threads INT               number of threads to use, zero for all cores (0)

Searching options
  --alnout FILENAME           filename for human-readable alignment output
  --blast6out FILENAME        filename for blast-like tab-separated output
  --db FILENAME               filename for FASTA formatted database for search
  --dbmask                    mask db with "dust", "soft" or "none" method (dust)
  --dbmatched FILENAME        FASTA file for matching database sequences
  --dbnotmatched FILENAME     FASTA file for non-matching database sequences
  --fastapairs FILENAME       FASTA file with pairs of query and target
  --fulldp                    full dynamic programming alignment (always on)
  --gapext STRING             penalties for gap extension (2I/1E)
  --gapopen STRING            penalties for gap opening (20I/2E)
  --hardmask                  mask by replacing with N instead of lower case
  --id REAL                   reject if identity lower
  --iddef INT                 id definition, 0-4=CD-HIT,all,int,MBL,BLAST (2)
  --idprefix INT              reject if first n nucleotides do not match
  --idsuffix INT              reject if last n nucleotides do not match
  --leftjust                  reject if terminal gaps at alignment left end
  --match INT                 score for match (2)
  --matched FILENAME          FASTA file for matching query sequences
  --maxaccepts INT            number of hits to accept and show per strand (1)
  --maxdiffs INT              reject if more substitutions or indels
  --maxgaps INT               reject if more indels
  --maxhits INT               maximum number of hits to show (unlimited)
  --maxid REAL                reject if identity higher
  --maxqsize INT              reject if query abundance larger
  --maxqt REAL                reject if query/target length ratio higher
  --maxrejects INT            number of non-matching hits to consider (32)
  --maxsizeratio REAL         reject if query/target abundance ratio higher
  --maxsl REAL                reject if shorter/longer length ratio higher
  --maxsubs INT               reject if more substitutions
  --mid REAL                  reject if percent identity lower, ignoring gaps
  --mincols INT               reject if alignment length shorter
  --minqt REAL                reject if query/target length ratio lower
  --minsizeratio REAL         reject if query/target abundance ratio lower
  --minsl REAL                reject if shorter/longer length ratio lower
  --mintsize INT              reject if target abundance lower
  --mismatch INT              score for mismatch (-4)
  --notmatched FILENAME       FASTA file for non-matching query sequences
  --output_no_hits            output non-matching queries to output files
  --qmask                     mask query with "dust", "soft" or "none" method (dust)
  --query_cov REAL            reject if fraction of query seq. aligned lower
  --rightjust                 reject if terminal gaps at alignment right end
  --rowlen INT                width of alignment lines in alnout output (64)
  --self                      reject if labels identical
  --selfid                    reject if sequences identical
  --sizeout                   write abundance annotation to output
  --strand                    search "plus" or "both" strands (plus)
  --target_cov REAL           reject if fraction of target seq. aligned lower
  --top_hits_only             output only hits with identity equal to the best
  --uc FILENAME               filename for UCLUST-like output
  --uc_allhits                show all, not just top hit with uc output
  --usearch_global FILENAME   filename of queries for global alignment search
  --userfields STRING         fields to output in userout file
  --userout FILENAME          filename for user-defined tab-separated output
  --weak_id REAL              include aligned hits with >= id; continue search
  --wordlength INT            length of words for database index 3-15 (8)

@EXTERNAL_DOCUMENTATION@

-------

@REFERENCES@


]]>
    </help>
</tool>
