<tool id="vsearch_clustering" name="VSearch" version="@VERSION@.0">
    <description>clustering</description>
    <expand macro="requirements" />
    <expand macro="stdio" />
    <expand macro="version_command" />
    <macros>
        <import>vsearch_macros.xml</import>
    </macros>
    <command>
<![CDATA[
    vsearch
        @GENERAL@
        --cluster_fast "$infile"
        ##--cluster_smallmem FILENAME  cluster sequences using a small amount of memory
        ##--clusters STRING            output each cluster to a separate FASTA file

        $cons_truncate
        --id $id
        ##--iddef $iddef

        #if '--msaout' in list($outputs):
            --msaout $msaout
        #end if
        #if '--consout' in list($outputs):
            --consout $consout
        #end if
        #if '--centroids' in list($outputs):
            --centroids $centroids
        #end if
        #if '--uc' in list($outputs):
            --uc $uc
        #end if
        #if $qmask != 'no':
            --qmask $qmask
        #end if
        #if $sizein:
            --sizein $sizein
        #end if
        #if $sizeout:
            --sizeout $sizeout
        #end if
        --strand $strand
        --usersort $usersort

]]>
    </command>
    <inputs>
        <param name="infile" type="data" format="fasta" label="Select your FASTA file" help="(--cluster_fast)" />
        <expand macro="id_and_iddef" />
        <param name="cons_truncate" type="boolean" truevalue="--cons_truncate" falsevalue="" checked="False" 
            label="Do not ignore terminal gaps in MSA for consensus" help="(--cons_truncate)"/>
        <param name="usersort" type="boolean" truevalue="--usersort" falsevalue="" checked="False" 
            label="Indicate that input sequences are presorted" help="(--usersort)"/>
        <expand macro="qmask" />
        <expand macro="sizein" />
        <expand macro="sizeout" />
        <expand macro="strand" />
        <param name="outputs" type="select" multiple="True" label="Select output files" help="">
            <option value="--msaout">Multiple sequence alignments</option>
            <option value="--consout">Cluster consensus sequences</option>
            <option value="--centroids">Centroid sequences</option>
            <option value="--uc">UCLUST-like</option>
            <validator type="no_options" message="Please select at least one output." />
        </param>

    </inputs>
    <outputs>
        <data name="msaout" format="fasta" label="${tool.name} on ${on_string}: Multiple Sequence Alignments">
            <filter>'--msaout' in outputs</filter>
        </data>
        <data name="consout" format="fasta" label="${tool.name} on ${on_string}: Consensus Sequences">
            <filter>'--consout' in outputs</filter>
        </data>
        <data name="centroids" format="fasta" label="${tool.name} on ${on_string}: Cluster centroids">
            <filter>'--centroids' in outputs</filter>
        </data>
        <data name="uc" format="fasta" label="${tool.name} on ${on_string}: UCLUST like output">
            <filter>'--uc' in outputs</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="infile" value="rhodopsin_nucs.fasta" ftype="fasta" />
            <param name="msaout" value="--msaout"/>
            <param name="outputs" value="--msaout,--centroids"/>
            <output name="centroids" file="clustering_centroids_result1.fasta" ftype="fasta" />
            <output name="msaout" file="clustering_msaout_result1.fasta" ftype="fasta" />
        </test>
    </tests>
    <help>
<![CDATA[
**What it does**

General options
  --help                      display help information
  --version                   display version information
  --fasta_width INT           width of FASTA seq lines, 0 for no wrap (80)
  --maxseqlength INT          maximum sequence length (50000)
  --minseqlength INT          min seq length (clust/derep/search: 32, other:1)
  --notrunclabels             do not truncate labels at first space
  --threads INT               number of threads to use, zero for all cores (0)

Clustering options (most searching options also apply)
  --centroids FILENAME         output centroid sequences to FASTA file
  --cluster_fast FILENAME      cluster sequences fast
  --cluster_smallmem FILENAME  cluster sequences using a small amount of memory
  --clusters STRING            output each cluster to a separate FASTA file
  --consout FILENAME           output cluster consensus sequences to FASTA file
  --cons_truncate              do not ignore terminal gaps in MSA for consensus
  --id REAL                    reject if identity lower
  --iddef INT                  id definition, 0-4=CD-HIT,all,int,MBL,BLAST (2)
  --msaout FILENAME            output multiple seq. alignments to FASTA file 
  --qmask                      mask seqs with dust, soft or no method (dust)
  --sizein                     read abundance annotation from input
  --sizeout                    write cluster abundances to centroid file
  --strand                     cluster using "plus" or "both" strands (plus)
  --uc FILENAME                filename for UCLUST-like output
  --usersort                   indicate that input sequences are presorted


@EXTERNAL_DOCUMENTATION@

-------

@REFERENCES@


]]>
    </help>
</tool>
